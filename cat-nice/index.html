<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>ç¬¨çŒ«å…ˆé£</title>
  <style>
    :root {
      --bg-color: #f0f0f0;
      --card-bg: #ffffff;
      --accent-color: #ff6b6b;
      --border-color: #000;
      --shadow-color: #000;
      --shadow-offset: 6px;
    }

    body {
      margin: 0;
      padding: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      background-color: var(--bg-color);
      background-image: radial-gradient(circle at 10% 20%, rgb(242, 235, 243) 0%, rgb(234, 241, 249) 90%);
      font-family: 'Courier New', Courier, monospace;
      overflow: hidden;
      user-select: none;
    }

    /* è£…é¥°èƒŒæ™¯åœ†ç‚¹ */
    body::before {
        content: '';
        position: absolute;
        width: 100%;
        height: 100%;
        background-image: radial-gradient(#333 1px, transparent 1px);
        background-size: 20px 20px;
        opacity: 0.1;
        z-index: -1;
    }

    #game-container {
      position: relative;
      width: 90%;
      max-width: 400px;
      height: 650px;
      background: var(--card-bg);
      border: 6px solid var(--border-color);
      box-shadow: var(--shadow-offset) var(--shadow-offset) 0 var(--shadow-color);
      border-radius: 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
      overflow: hidden;
      transition: transform 0.2s;
    }

    /* é¡¶éƒ¨ä¿¡æ¯æ  */
    #ui-layer {
      width: 100%;
      padding: 24px;
      text-align: center;
      font-size: 28px;
      font-weight: 900;
      color: var(--border-color);
      letter-spacing: -1px;
      text-transform: uppercase;
    }

    /* æŠ½è±¡æ°”æ³¡ */
    #bubble {
      background: #fff;
      border: 4px solid var(--border-color);
      box-shadow: 4px 4px 0 var(--shadow-color);
      border-radius: 0px 20px 20px 20px;
      padding: 15px 25px;
      margin-top: 10px;
      position: relative;
      font-size: 20px;
      font-weight: bold;
      min-height: 30px;
      max-width: 80%;
      transform: rotate(-1deg);
    }
    
    #bubble::after {
        content: '';
        position: absolute;
        left: -8px;
        top: 0;
        width: 0;
        height: 0;
        border-top: 20px solid var(--border-color);
        border-left: 20px solid transparent;
        transform: skewY(20deg);
    }

    /* çŒ«å’ªåŒºåŸŸ */
    #cat-area {
      position: relative;
      flex-grow: 1;
      width: 100%;
      display: flex;
      justify-content: center;
      align-items: flex-end;
      padding-bottom: 60px;
    }

    #cat {
      font-size: 110px;
      z-index: 2;
      animation: float 3s ease-in-out infinite;
      filter: drop-shadow(4px 4px 0px rgba(0,0,0,0.2));
    }

    #paw {
      position: absolute;
      font-size: 60px;
      bottom: 40px;
      left: 50%;
      transform: translateX(-50%) translateY(50px);
      opacity: 0;
      transition: all 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      z-index: 3;
    }

    /* æ‰è½å¥–åŠ± */
    #reward {
      position: absolute;
      top: -50px;
      font-size: 50px;
      z-index: 1;
      display: none;
    }

    /* ç‰©å“æ’åˆ— */
    #items-tray {
      width: 100%;
      background: transparent;
      display: flex;
      justify-content: space-evenly;
      align-items: center;
      padding: 20px 10px;
      padding-bottom: 30px;
      box-sizing: border-box;
      gap: 10px;
      border-top: 4px dashed #333;
    }

    .item-btn {
      width: 75px;
      height: 75px;
      background: white;
      border: 4px solid var(--border-color);
      box-shadow: 4px 4px 0 var(--shadow-color);
      border-radius: 12px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      cursor: pointer;
      transition: all 0.15s;
    }

    /* éšæœºæ—‹è½¬ä¸€ç‚¹ç‚¹ï¼Œå¢åŠ æŠ½è±¡æ„Ÿ */
    .item-btn:nth-child(odd) { transform: rotate(-2deg); }
    .item-btn:nth-child(even) { transform: rotate(2deg); }

    .item-btn:active {
      transform: translate(2px, 2px) rotate(0deg) !important;
      box-shadow: 2px 2px 0 var(--shadow-color);
    }

    .item-icon {
      font-size: 32px;
    }

    .item-label {
      font-size: 12px;
      margin-top: 4px;
      font-weight: 900;
    }

    /* åŠ¨ç”»æ•ˆæœ */
    @keyframes drop {
      0% { transform: translateY(0) rotate(0deg); opacity: 1; }
      100% { transform: translateY(280px) rotate(360deg); opacity: 0; }
    }
    
    @keyframes float {
        0% { transform: translateY(0px) rotate(0deg); }
        50% { transform: translateY(-15px) rotate(2deg); }
        100% { transform: translateY(0px) rotate(0deg); }
    }

    .animate-drop {
      display: block !important;
      animation: drop 0.8s forwards;
    }

    .success-paw {
      transform: translateX(-50%) translateY(-70px) scale(1.2) !important;
      opacity: 1 !important;
    }

    #start-btn {
      font-family: inherit;
      font-size: 22px;
      font-weight: 900;
      padding: 10px 30px;
      background: #ffda44;
      border: 4px solid #333;
      border-radius: 10px;
      cursor: pointer;
      box-shadow: 5px 5px 0 #333;
      transition: all 0.1s;
      text-transform: uppercase;
      transform: rotate(1deg);
      display: inline-block;
    }

    #start-btn:active {
      transform: translate(3px, 3px) rotate(1deg);
      box-shadow: 2px 2px 0 #333;
    }
  </style>
</head>

<body>

  <div id="game-container">
    <div id="ui-layer">
      å¾—åˆ†: <span id="score">0</span>
    </div>

    <div id="bubble">
      <button id="start-btn">å¼€å§‹æ¸¸æˆ</button>
    </div>

    <div id="cat-area">
      <div id="reward">ğŸŸ</div>
      <!-- è¿™é‡Œå°†æ¥æ¢æˆåƒç´ çŒ«å’ªå›¾ç‰‡ -->
      <div id="cat">ğŸ±</div>
      <!-- è¿™é‡Œå°†æ¥æ¢æˆåƒç´ çŒ«çˆªå›¾ç‰‡ -->
      <div id="paw">ğŸ¾</div>
    </div>

    <div id="items-tray" id="items-container">
      <!-- ç‰©å“ç”± JS åŠ¨æ€ç”Ÿæˆ -->
    </div>
  </div>

  <script>
    // æ¸¸æˆæ•°æ®é…ç½®
    const gameData = [
      { name: 'èåœ', icon: 'ğŸ¥•', audio: 'mp3/èåœ.MP3' },
      { name: 'çº¸å·¾', icon: 'ğŸ§»', audio: 'mp3/çº¸å·¾.MP3' },
      { name: 'ç±³è€é¼ ', icon: 'ğŸ­', audio: 'mp3/ç±³è€é¼ .MP3' },
      { name: 'çŒ«ç²®', icon: 'ğŸ¥«', audio: 'mp3/çŒ«ç²®.MP3' },
      { name: 'åŒ…åŒ…', icon: 'ğŸ‘œ', audio: 'mp3/åŒ…åŒ….MP3' }
    ]

    const successSounds = [
      'mp3/ 1çœŸæ£’.MP3',
      'mp3/ 2çœŸæ£’.MP3',
      'mp3/ 3çœŸæ£’.MP3'
    ]
    const meowSound = 'mp3/ 1å–µ.MP3'

    let currentTarget = null
    let score = 0
    let isAnimate = false

    const bubble = document.getElementById('bubble')
    const scoreEl = document.getElementById('score')
    const cat = document.getElementById('cat')
    const paw = document.getElementById('paw')
    const reward = document.getElementById('reward')
    const tray = document.getElementById('items-tray')

    // éŸ³é¢‘ç¼“å­˜æ± 
    const audioCache = {}

    // é¢„åŠ è½½æ‰€æœ‰éŸ³é¢‘
    function preloadAllAudio() {
      const startBtn = document.getElementById('start-btn')
      startBtn.innerText = 'èµ„æºåŠ è½½ä¸­...'
      startBtn.style.opacity = '0.6'
      // æš‚æ—¶ç§»é™¤ç‚¹å‡»äº‹ä»¶é˜²æ­¢æœªåŠ è½½å®Œæˆå°±å¼€å§‹
      const originOnClick = startBtn.onclick
      startBtn.onclick = null

      const allSounds = [
        ...gameData.map(item => item.audio),
        ...successSounds,
        meowSound
      ]

      let loadedCount = 0
      const total = allSounds.length

      function checkLoaded() {
        loadedCount++
        startBtn.innerText = `åŠ è½½ä¸­ ${loadedCount}/${total}`
        
        if (loadedCount >= total) {
          startBtn.innerText = 'å¼€å§‹æ¸¸æˆ'
          startBtn.style.opacity = '1'
          // æ¢å¤ç‚¹å‡»äº‹ä»¶
          startBtn.onclick = function() {
              nextRound()
          }
        }
      }

      allSounds.forEach(src => {
        const audio = new Audio()
        audio.src = src
        audio.preload = 'auto'
        
        // æ˜¾å¼è°ƒç”¨ load æ–¹æ³•
        audio.load()

        // ç›‘å¬åŠ è½½å®Œæˆ
        // å¦‚æœéŸ³é¢‘å·²ç»ç¼“å­˜æˆ–åŠ è½½å¾ˆå¿«ï¼ŒreadyState å¯èƒ½å·²ç»è¶³å¤Ÿå¤§
        if (audio.readyState >= 3) { // HAVE_FUTURE_DATA
            checkLoaded()
        } else {
            // ç»‘å®šä¸€æ¬¡æ€§ç›‘å¬å™¨
            audio.addEventListener('canplaythrough', checkLoaded, { once: true })
            // å®¹é”™å¤„ç†ï¼šå¦‚æœåŠ è½½å¤±è´¥ä¹Ÿç®—ä½œå®Œæˆï¼Œé¿å…å¡æ­»
            audio.addEventListener('error', (e) => {
                console.error('Audio load failed:', src, e)
                checkLoaded()
            }, { once: true })
        }
        
        audioCache[src] = audio
      })
    }

    function playSound(src) {
      if (!src) return
      
      let audio = audioCache[src]
      // å¦‚æœæ²¡æœ‰ç¼“å­˜ï¼ˆé˜²å¾¡æ€§ç¼–ç¨‹ï¼‰ï¼Œä¸´æ—¶åˆ›å»ºä¸€ä¸ª
      if (!audio) {
        audio = new Audio(src)
      }

      // é‡ç½®æ’­æ”¾è¿›åº¦ï¼Œç¡®ä¿å¯ä»¥è¿ç»­æ’­æ”¾
      audio.currentTime = 0
      
      const playPromise = audio.play()
      if (playPromise !== undefined) {
        playPromise.catch(e => {
          console.log('Audio play error:', e)
        })
      }
    }

    // åˆå§‹åŒ–ç‰©å“æ 
    function initTray() {
      preloadAllAudio() // å¯åŠ¨é¢„åŠ è½½
      tray.innerHTML = ''
      gameData.forEach(item => {
        const btn = document.createElement('div')
        btn.className = 'item-btn'
        btn.innerHTML = `
                <div class="item-icon">${item.icon}</div>
                <div class="item-label">${item.name}</div>
            `
        btn.onclick = () => handleInput(item)
        tray.appendChild(btn)
      })
    }

    // å¼€å§‹ä¸‹ä¸€è½®
    function nextRound() {
      isAnimate = false
      const randomIndex = Math.floor(Math.random() * gameData.length)
      currentTarget = gameData[randomIndex]

      // æ¨¡æ‹Ÿä¸»äººè¯´è¯
      bubble.innerText = `ä¸»äººï¼šâ€œ${currentTarget.name}ï¼â€`
      bubble.style.color = '#333'

      // æ’­æ”¾ç‰©å“è¯­éŸ³
      playSound(currentTarget.audio)
    }

    // å¤„ç†ç‚¹å‡»
    function handleInput(selectedItem) {
      if (isAnimate) return
      isAnimate = true

      if (selectedItem.name === currentTarget.name) {
        // æ­£ç¡®é€»è¾‘
        score += 10
        scoreEl.innerText = score
        bubble.innerText = "ä¸»äººï¼šâ€œçœŸæ£’ï¼å¥–åŠ±å°é±¼å¹²ï¼â€"
        bubble.style.color = "green"

        // æ’­æ”¾æˆåŠŸéŸ³æ•ˆï¼šçœŸæ£’
        const randomSound = successSounds[Math.floor(Math.random() * successSounds.length)]
        playSound(randomSound)

        // æ’­æ”¾åŠ¨ä½œ
        playSuccessAnimation()
      } else {
        // é”™è¯¯é€»è¾‘
        score = 0
        scoreEl.innerText = score
        bubble.innerText = "ä¸»äººï¼šâ€œè¯¶ï¼Ÿä¸æ˜¯è¿™ä¸ªå“¦...â€"
        bubble.style.color = "red"

        playFailAnimation()
      }
    }

    function playSuccessAnimation() {
      // çŒ«çˆªä¼¸å‡º
      paw.classList.add('success-paw')

      setTimeout(() => {
        // æ‰è½é±¼å¹²
        reward.classList.add('animate-drop')
        // çŒ«å’ªå¼€å¿ƒ
        cat.innerText = 'ğŸ˜¸'
        
        setTimeout(() => {
          paw.classList.remove('success-paw')
          reward.classList.remove('animate-drop')
          cat.innerText = 'ğŸ±'
          nextRound()
        }, 1000)
      }, 300)
    }

    function playFailAnimation() {
      cat.innerText = 'ğŸ˜¿'
      playSound(meowSound)
      // æŠ–åŠ¨æ•ˆæœ
      cat.style.transform = 'translateX(10px)'
      setTimeout(() => {
        cat.style.transform = 'translateX(-10px)'
        setTimeout(() => {
          cat.style.transform = 'translateX(0)'
          cat.innerText = 'ğŸ±'

          // æ¢å¤æŒ‡ä»¤æ˜¾ç¤ºå¹¶é‡æ’­è¯­éŸ³ (ä¸åˆ‡æ¢ä¸‹ä¸€å…³)
          bubble.innerText = `ä¸»äººï¼šâ€œ${currentTarget.name}ï¼â€`
          bubble.style.color = '#333'
          playSound(currentTarget.audio)

          isAnimate = false // å…è®¸å†æ¬¡ç‚¹å‡»
        }, 500) // ç¨å¾®å»¶é•¿é”™è¯¯æç¤ºæ—¶é—´
      }, 100)
    }

    // å¯åŠ¨æ¸¸æˆ
    initTray()

    // å¯åŠ¨æ¸¸æˆ
    initTray()

    // ç»‘å®šå¼€å§‹æŒ‰é’®äº‹ä»¶ - åˆå§‹çŠ¶æ€ä¸‹ä¸ç›´æ¥ç»‘å®šï¼Œç­‰å¾…èµ„æºåŠ è½½å®Œæˆ
    // é€»è¾‘å·²ç§»åŠ¨åˆ° preloadAllAudio ä¸­ dynamically binding
    // document.getElementById('start-btn').onclick = ...

  </script>
</body>

</html>
